{% extends '::base.html.twig' %}

{% block title %}{{ table.title }} | {{ parent() }}{% endblock %}
{% block javascripts %}
    {{ parent() }}
    <script src="http://code.highcharts.com/highcharts.js"></script>
    <script src="http://code.highcharts.com/modules/exporting.js"></script>
{% endblock %}

{% block body %}


        <ol class="breadcrumb">
            {{ parent() }}
            <li><a href="{{ path('userPage',{'id': table.experiment.user.id}) }}">Главная</a></li>
            <li><a href="{{ path('userExperiment',{'id': table.experiment.user.id, 'experimentId': table.experiment.id}) }}">{{ table.experiment.name }}</a></li>
            <li class="active">{{ table.title }}</li>
        </ol>

        <div class="al-center">
            {#<h3>{{ table.title }}</h3>#}
            <p>{{ table.info }}</p>
        </div>


        <table class="table table-hover table-bordered table-condensed">

            <tbody>
            {% for row in table.rows %}
                <script>
                    var arr{{ loop.index }} = [];
                    var first = true;
                </script>
                <tr>
                    {% for value in row.values %}
                        <td>{{ value.value }}</td>
                        <script>
                            if (first) {
                                first = false;
                            } else {
                                if ( {{ loop.parent.loop.index }} == {{ 1 }}) {
                                    arr{{ loop.parent.loop.index }}.push("{{ value.value }}");
                                } else {
                                    arr{{ loop.parent.loop.index }}.push({{ value.value }});
                                }
                            }
                        </script>
                    {% endfor %}

                </tr>

            {% endfor %}
            </tbody>

        </table><br>

    <button id="showColumnChart" type="button" class="btn btn-primary">Show Column chart</button>
    <button id="showCombinChart" type="button" class="btn btn-primary">Show Combination chart</button>
    <button id="showSplineChart" type="button" class="btn btn-primary">Show Spline chart</button>

    <div id="container" style="margin-top:20px; height: 400px"></div>

    <script>


        $(function(){
            $("#showColumnChart").on("click", function(){
                $('#container').highcharts({
                    chart: {
                        type: 'column'
                    },
                    title: {
                        text: '{{ table.title }}'
                    },
                    subtitle: {
                        text: '{{ table.info }}'
                    },
                    xAxis: {
                        categories: arr1 // 100 200 300 ... row[0] col[1..n]
                    },
                    yAxis: {
                        title: {
                            text: '{{ table.cellLabel }}'
                        }
                    },
                    credits: {
                        enabled: false
                    },
                    series: [
                        {% for row in table.rows[1:] %}
                        {
                            name: '{{ row.values|first.value }}', // row[1...n] col[0]
                            data: arr{{ loop.index+1 }}
                        },
                        {% endfor %}]
                });
            });
        });

        $(function(){
            $("#showCombinChart").on("click", function(){
                $('#container').highcharts({
                    title: {
                        text: '{{ table.title }}'
                    },
                    subtitle: {
                        text: '{{ table.info }}'
                    },
                    xAxis: {
                        categories: arr1
                    },
                    yAxis: {
                        title: {
                            text: '{{ table.cellLabel }}'
                        }
                    },
                    credits: {
                        enabled: false
                    },
                    series: [
                        {% for row in table.rows[1:] %}
                        {   type: 'column',
                            name: '{{ row.values|first.value }}',
                            data: arr{{ loop.index+1 }}
                        },

                        {
                            type: 'spline',
                            name: 'MAX',
                            data: arr{{ loop.index+1 }},
                            marker: {
                                lineWidth: 2,
                                lineColor: Highcharts.getOptions().colors[3],
                                fillColor: 'white',
                                states: {
                                    select: true
                                }

                            }
                        },
                        {% endfor %}

                    ]
                });
            });
        });

        $(function(){
            $("#showSplineChart").on("click", function(){
                $('#container').highcharts({
                    chart: {
                        type: 'spline',
                        marginRight: 120
                    },
                    title: {
                        text: '{{ table.title }}'
                    },
                    subtitle: {
                        text: '{{ table.info }}'
                    },

                    legend: {
                        align: 'right',
                        verticalAlign: 'top',
                        layout: 'vertical',
                        itemMarginBottom: 10,
                        x: 0,
                        y: 100
                    },
                    xAxis: {
                        categories: arr1
                    },
                    yAxis: {
                        title: {
                            text: '{{ table.cellLabel }}'
                        }
                    },
                    plotOptions: {
                        line: {
                            dataLabels: {
                                enabled: true
                            },
                            enableMouseTracking: false
                        }
                    },
                    series: [
                        {% for row in table.rows[1:] %}
                        {
                            name: '{{ row.values|first.value }}',
                            data: arr{{ loop.index+1 }}
                        },
                        {% endfor %}]
                });
            });
        });

    </script>




{% endblock %}